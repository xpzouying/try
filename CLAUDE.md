# CLAUDE.md

## Project Overview

**try** - A CLI tool to manage experimental project directories. Go rewrite of [tobi/try](https://github.com/tobi/try).

Core philosophy: "Your experiments deserve a home."

## Architecture

### Directory Structure

```
try/
├── main.go              # Entry point, CLI parsing
├── internal/
│   ├── selector/        # Interactive TUI selector
│   │   ├── selector.go  # Main selector logic
│   │   └── model.go     # Bubbletea model
│   ├── fuzzy/           # Fuzzy matching algorithm
│   │   ├── fuzzy.go
│   │   └── fuzzy_test.go
│   ├── entry/           # Directory entry with scoring
│   │   ├── entry.go
│   │   └── entry_test.go
│   └── shell/           # Shell integration (init, exec)
│       └── shell.go
├── go.mod
├── go.sum
├── README.md
├── CLAUDE.md
└── Makefile
```

### Core Dependencies

| Package | Purpose | Why |
|---------|---------|-----|
| `github.com/charmbracelet/bubbletea` | TUI framework | Elm-style architecture, handles terminal state |
| `github.com/charmbracelet/lipgloss` | Styling | Clean ANSI styling, pairs with bubbletea |
| `github.com/mattn/go-runewidth` | Unicode width | Emoji/CJK character width calculation |

**No CLI framework** - Use standard library `flag` package. The CLI is simple enough.

### Data Flow

```
User Input → CLI Parser → Command Router
                              │
              ┌───────────────┼───────────────┐
              ▼               ▼               ▼
           [init]          [exec]          [clone]
              │               │               │
              ▼               ▼               ▼
        Print shell      TUI Selector     Git clone
        wrapper func         │               │
                             ▼               ▼
                      Print cd/mkdir    Print cd
                        command          command
```

### Key Design Decisions

1. **Output to stdout for shell eval** - Print commands (`cd`, `mkdir`) that shell wrapper `eval`s
2. **Single binary** - No external dependencies at runtime
3. **Internal packages** - Use `internal/` to prevent external imports
4. **Minimal abstraction** - Flat structure, avoid unnecessary interfaces

## Development Plan

### Phase 1: Core Foundation (MVP)
- [ ] Go module setup with dependencies
- [ ] `try init` - Shell wrapper generation (bash/zsh/fish)
- [ ] Directory scanning with date-prefix detection
- [ ] Basic entry scoring (recency + name match)
- [ ] `try <name>` - Create new experiment directory

### Phase 2: Interactive Selector
- [ ] Bubbletea TUI model
- [ ] Fuzzy matching algorithm
- [ ] Keyboard navigation (arrows, Ctrl-P/N)
- [ ] Basic search filtering

### Phase 3: Full Features
- [ ] `try clone <url>` - Git clone integration
- [ ] `try worktree` - Git worktree support
- [ ] Ctrl-D delete with confirmation
- [ ] Ctrl-R rename
- [ ] Ctrl-G graduate to projects

### Phase 4: Polish
- [ ] Fish shell support
- [ ] Tests for all components
- [ ] Cross-platform build (Makefile)
- [ ] Release automation

## Commands Reference

```bash
# Development
go build -o try .           # Build binary
go test ./...               # Run tests
make install                # Install to $GOPATH/bin

# Testing manually
./try init bash             # Output bash wrapper
./try exec                  # Launch interactive selector
./try exec redis            # Search for "redis"
```

## Implementation Notes

### Shell Integration Pattern

The tool prints shell commands to stdout. The shell wrapper function captures and `eval`s them:

```bash
# Shell wrapper (generated by `try init`)
try() {
  local output
  output=$(/path/to/try exec "$@")
  if [[ -n "$output" ]]; then
    eval "$output"
  fi
}
```

### Scoring Algorithm

```
score = base_score (from access time)
      + match_quality (fuzzy match score)
      + recency_bonus (recently accessed)
      + name_bonus (matches date pattern)
```

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `TRY_PATH` | `~/src/tries` | Root directory for experiments |
| `TRY_PROJECTS` | Parent of TRY_PATH | Destination for graduated projects |

## Code Style

- **No comments for obvious code** - Code should be self-documenting
- **Table-driven tests** - Use subtests with `t.Run()`
- **Error wrapping** - Use `fmt.Errorf("context: %w", err)`
- **Early returns** - Avoid deep nesting

## Memories

(Add learnings here as development progresses)
